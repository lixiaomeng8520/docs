常用命令
========

参考资料

* `linux命令大全 <http://www.runoob.com/linux/linux-command-manual.html>`_
* `​linux系统排查​ <https://www.cnblogs.com/Security-Darren/p/4685629.html>`_

curl
^^^^

+----------------------------+----------------------------------------------------------------+
| 描述                       | 命令                                                           |
+============================+================================================================+
| 下载                       | ``curl -L url -o target``                                      |
+----------------------------+----------------------------------------------------------------+
| POST请求                   | ``curl -X POST -H Content-Type:text/html url -d postdata``     |
+----------------------------+----------------------------------------------------------------+

ssh
^^^

+----------------------------+----------------------------------------------------------------+
| 描述                       | 命令                                                           |
+============================+================================================================+
| 生成密钥                   | ``ssh-keygen -t rsa``                                          |
+----------------------------+----------------------------------------------------------------+
| 拷贝默认公钥到远程主机     | ``ssh-copy-id root@master``                                    |
+----------------------------+----------------------------------------------------------------+
| 拷贝指定公钥到远程主机     | ``ssh-copy-id -i ~/.ssh/id_rsa.pub root@master``               |
+----------------------------+----------------------------------------------------------------+

yum
^^^

远程仓库的软件包信息

+----------------------------+----------------------------------------------------------------+
| 描述                       | 命令                                                           |
+============================+================================================================+
| 清理缓存                   | ``yum clean all``                                              |
+----------------------------+----------------------------------------------------------------+
| 生成缓存                   | ``yum makecache``                                              |
+----------------------------+----------------------------------------------------------------+
| 查看仓库列表               | ``yum repolist``                                               |
+----------------------------+----------------------------------------------------------------+
| 查看一个包信息             | ``yum info php71u-cli``                                        |
+----------------------------+----------------------------------------------------------------+
| 查看一个包依赖             | ``yum deplist php71u-cli``                                     |
+----------------------------+----------------------------------------------------------------+
| 查看一个文件属于哪个包     | ``yum provides netstat``                                       |
+----------------------------+----------------------------------------------------------------+

rpm
^^^

本地的软件包信息

+----------------------------+----------------------------------------------------------------+
| 描述                       | 命令                                                           |
+============================+================================================================+
| 查询php71u是否安装         | ``rpm -q php71u-fpm``                                          |
+----------------------------+----------------------------------------------------------------+
| 查看php71u包信息           | ``rpm -qi php71u-fpm``                                         |
+----------------------------+----------------------------------------------------------------+
| 列出php71u包含的文件       | ``rpm -ql php71u-fpm``                                         |
+----------------------------+----------------------------------------------------------------+
| 查看filename属于哪个rpm包  | ``rpm -qf filename``                                           |
+----------------------------+----------------------------------------------------------------+

tar
^^^
压缩的哪些文件，是相对于-C参数的，如果没有，则是当前目录。

+----------------------------+----------------------------------------------------------------+
| 描述                       | 命令                                                           |
+============================+================================================================+
| 解压到当前文件夹           | ``tar zxvf xx.tar.gz``                                         |
+----------------------------+----------------------------------------------------------------+
| 解压到指定文件夹           | ``tar -zxvf xx.tar.gz -C dir``                                 |
+----------------------------+----------------------------------------------------------------+
| 列出包文件                 | ``tar -ztvf xx.tar.gz``                                        |
+----------------------------+----------------------------------------------------------------+
| 全部文件压缩               | ``tar -zcvf xx.tar.gz [-C /dir] .``                           |
+----------------------------+----------------------------------------------------------------+
| 指定文件（夹）压缩         | ``tar -zcvf xx.tar.gz [-C /dir] b/ a.txt``                     |
+----------------------------+----------------------------------------------------------------+

wc
^^

利用wc指令我们可以计算文件的Byte数、字数、或是列数，若不指定文件名称、或是所给予的文件名为"-"，则wc指令会从标准输入设备读取数据。

+----------------------------+----------------------------------------------------------------+
| 描述                       | 命令                                                           |
+============================+================================================================+
| 统计文件信息               | ``wc file``                                                    |
+----------------------------+----------------------------------------------------------------+
| 显示file文件行数           | ``wc -l file``                                                 |
+----------------------------+----------------------------------------------------------------+
| 显示文件单词数             | ``wc -w file``                                                 |
+----------------------------+----------------------------------------------------------------+
| 显示文件byte数             | ``wc -c file``                                                 |
+----------------------------+----------------------------------------------------------------+
| 统计普通文件个数           | ``ls -l dir | grep '^-' | wc -l``                              |
+----------------------------+----------------------------------------------------------------+
| 统计目录个数               | ``ls -l dir | grep '^d' | wc -l``                              |
+----------------------------+----------------------------------------------------------------+
| 递归统计普通文件个数       | ``ls -lR dir | grep '^-' | wc -l``                             |
+----------------------------+----------------------------------------------------------------+

sed
^^^

+----------------------------+----------------------------------------------------------------+
| 描述                       | 命令                                                           |
+============================+================================================================+
| 全局替换                   | ``sed -i 's/原字符串/替换字符串/g' file``                      |
+----------------------------+----------------------------------------------------------------+

rz, sz
^^^^^^

+----------------------------+----------------------------------------------------------------+
| 描述                       | 命令                                                           |
+============================+================================================================+
| 从windows接收文件          | ``rz``                                                         |
+----------------------------+----------------------------------------------------------------+
| 发送文件a.txt到windows     | ``sz a.txt``                                                   |
+----------------------------+----------------------------------------------------------------+

netstat
^^^^^^^

netstat 是一款命令行工具，可用于列出系统上所有的网络套接字连接情况，包括 tcp, udp 以及 unix 套接字，另外它还能列出处于监听状态（即等待接入请求）的套接字。

.. code-block:: bash

    -l 监听中
    -a 所有
    -t tcp
    -u udp
    -n 禁用域名解析
    -p 进程
    -e 用户

+----------------------------+----------------------------------------------------------------+
| 描述                       | 命令                                                           |
+============================+================================================================+
| 正在监听的tcp              | ``netstat -ntlpe``                                             |
+----------------------------+----------------------------------------------------------------+

nmcli
^^^^^

+----------------------------+-----------------------------------------------------------------------------------------------------+
| 描述                       | 命令                                                                                                |
+============================+=====================================================================================================+
| 查看所有设备               | ``nmcli d``                                                                                         |
+----------------------------+-----------------------------------------------------------------------------------------------------+
| 查看所有连接               | ``nmcli c``                                                                                         |
+----------------------------+-----------------------------------------------------------------------------------------------------+
| 查看连接详情               | ``nmcli c show static``                                                                             |
+----------------------------+-----------------------------------------------------------------------------------------------------+
| 添加dhcp连接               | ``nmcli c add con-name dhcp type ethernet ifname enp0s3``                                           |
+----------------------------+-----------------------------------------------------------------------------------------------------+
| 添加static连接             | ``nmcli c add con-name static type ethernet ifname enp0s3 ip4 192.168.56.20/24 gw4 192.168.56.1``   |
+----------------------------+-----------------------------------------------------------------------------------------------------+
| 修改连接属性，参考show     | ``nmcli c mod con-name ipv4.addresses 192.168.56.20/24``                                            |
+----------------------------+-----------------------------------------------------------------------------------------------------+
| 修改连接为静态连接         | ``nmcli c mod con-name ipv4.method manual``                                                         |
+----------------------------+-----------------------------------------------------------------------------------------------------+
| 启动连接                   | ``nmcli c up con-name``                                                                             |
+----------------------------+-----------------------------------------------------------------------------------------------------+
| 关闭连接                   | ``nmcli c up con-name``                                                                             |
+----------------------------+-----------------------------------------------------------------------------------------------------+

2>&1
^^^^

希望将标准错误和标准输出都重定向到一个文件中，那么不要分别重定向，因为会打开文件两次，下面是将标准错误重定向到标准输出，再由标准输出重定向到文件。

+----------------------------+----------------------------------------------------------------+
| 描述                       | 命令                                                           |
+============================+================================================================+
| 将输出和错误重定向到a.log  | ``command > a.log 2>&1``                                       |
+----------------------------+----------------------------------------------------------------+

ln
^^

参考：`5分钟让你明白“软链接”和“硬链接”的区别 <https://www.jianshu.com/p/dde6a01c4094>`_

.. note::

    删除目录软链，目录最后不能带\/，否则会把原目录里的文件都给删了，软链却不会删
    
    目前不用硬链

+----------------------------+----------------------------------------------------------------+
| 描述                       | 命令                                                           |
+============================+================================================================+
| 创建一个软链               | ``ln -s source target``                                        |
+----------------------------+----------------------------------------------------------------+
| 删除一个文件软链           | ``rm -rf target``                                              |
+----------------------------+----------------------------------------------------------------+
| 删除一个目录软链           | ``rm -rf target``                                              |
+----------------------------+----------------------------------------------------------------+